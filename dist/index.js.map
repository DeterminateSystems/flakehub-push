{"version":3,"sources":["../ts/index.ts"],"sourcesContent":["import * as actionsCore from \"@actions/core\";\nimport { ActionOptions, IdsToolbox, inputs, platform } from \"detsys-ts\";\n\ntype Visibility = \"public\" | \"unlisted\" | \"private\";\n\nclass FlakeHubPushAction {\n  idslib: IdsToolbox;\n  private architecture: string;\n\n  // Action inputs\n  private visibility: Visibility;\n  private name: string | null;\n  private repository: string;\n  private mirror: boolean;\n  private directory: string;\n  private gitRoot: string;\n  private tag: string;\n  private rollingMinor: string | null;\n  private rolling: boolean;\n  private host: string;\n  private logDirectives: string;\n  private logger: string;\n  private gitHubToken: string;\n  private extraLabels: string;\n  private spdxExpression: string;\n  private errorOnConflict: boolean;\n  private includeOutputPaths: boolean;\n  private flakeHubPushBinary: string | null;\n  private flakeHubPushBranch: string;\n  private flakeHubPushPullRequest: string | null;\n  private flakeHubPushRevision: string | null;\n  private flakeHubPushTag: string | null;\n  private flakeHubPushUrl: string | null;\n\n  constructor() {\n    const options: ActionOptions = {\n      name: \"flakehub-push\",\n      fetchStyle: \"gh-env-style\",\n      diagnosticsUrl: new URL(\n        \"https://install.determinate.systems/flakehub-push/telemetry\",\n      ),\n      requireNix: \"ignore\",\n    };\n\n    this.idslib = new IdsToolbox(options);\n    this.architecture = platform.getArchOs();\n\n    // Inputs\n    // TODO: check enum values\n    const visibility = inputs.getString(\"visibility\") as Visibility;\n    this.visibility = visibility;\n\n    this.name = inputs.getStringOrNull(\"name\");\n    this.repository = inputs.getString(\"repository\");\n    this.mirror = inputs.getBool(\"mirror\");\n    this.directory = inputs.getString(\"directory\");\n    this.gitRoot = inputs.getString(\"git-root\");\n    this.tag = inputs.getString(\"tag\");\n    this.rollingMinor = inputs.getStringOrNull(\"rolling-minor\");\n    this.rolling = inputs.getBool(\"rolling\");\n    this.host = inputs.getString(\"host\");\n    this.logDirectives = inputs.getString(\"log-directives\");\n    this.logger = inputs.getString(\"logger\");\n    this.gitHubToken = inputs.getString(\"github-token\");\n    // extra-tags is deprecated but we still honor it\n    this.extraLabels =\n      inputs.getString(\"extra-labels\") === \"\"\n        ? inputs.getString(\"extra-tags\")\n        : \"\";\n    this.spdxExpression = inputs.getString(\"spdx-expression\");\n    this.errorOnConflict = inputs.getBool(\"error-on-conflict\");\n    this.includeOutputPaths = inputs.getBool(\"include-output-paths\");\n    this.flakeHubPushBinary = inputs.getStringOrNull(\"flakehub-push-binary\");\n    this.flakeHubPushBranch = inputs.getString(\"flakehub-push-branch\");\n    this.flakeHubPushPullRequest = inputs.getStringOrNull(\"flakehub-push-pr\");\n    this.flakeHubPushRevision = inputs.getStringOrNull(\n      \"flakehub-push-revision\",\n    );\n    this.flakeHubPushTag = inputs.getStringOrNull(\"flakehub-push-tag\");\n    this.flakeHubPushUrl = inputs.getStringOrNull(\"flakehub-push-url\");\n  }\n\n  private makeUrl(endpoint: string, item: string): string {\n    return `https://install.determinate.systems/flakehub-push/${endpoint}/${item}/${this.architecture}?ci=github`;\n  }\n\n  private get defaultBinaryUrl(): string {\n    return `https://install.determinate.systems/flakehub-push/stable/${this.architecture}?ci=github`;\n  }\n\n  private get pushBinaryUrl(): string {\n    if (this.flakeHubPushBinary !== null) {\n      return this.flakeHubPushBinary;\n    } else if (this.flakeHubPushPullRequest !== null) {\n      return this.makeUrl(\"pr\", this.flakeHubPushPullRequest);\n    } else if (this.flakeHubPushTag !== null) {\n      return this.makeUrl(\"tag\", this.flakeHubPushTag);\n    } else if (this.flakeHubPushRevision !== null) {\n      return this.makeUrl(\"rev\", this.flakeHubPushRevision);\n    } else if (this.flakeHubPushBranch !== null) {\n      return this.makeUrl(\"branch\", this.flakeHubPushBranch);\n    } else {\n      return this.defaultBinaryUrl;\n    }\n  }\n\n  async push(): Promise<void> {\n    const pusbBinaryUrl = this.pushBinaryUrl;\n    actionsCore.info(`Fetching flakehub-push binary from ${pusbBinaryUrl}`);\n  }\n}\n\nfunction main(): void {\n  const flakeHubPush = new FlakeHubPushAction();\n\n  flakeHubPush.idslib.onMain(async () => {\n    await flakeHubPush.push();\n  });\n\n  flakeHubPush.idslib.execute();\n}\n\nmain();\n"],"mappings":";AAAA,YAAY,iBAAiB;AAC7B,SAAwB,YAAY,QAAQ,gBAAgB;AAI5D,IAAM,qBAAN,MAAyB;AAAA,EA6BvB,cAAc;AACZ,UAAM,UAAyB;AAAA,MAC7B,MAAM;AAAA,MACN,YAAY;AAAA,MACZ,gBAAgB,IAAI;AAAA,QAClB;AAAA,MACF;AAAA,MACA,YAAY;AAAA,IACd;AAEA,SAAK,SAAS,IAAI,WAAW,OAAO;AACpC,SAAK,eAAe,SAAS,UAAU;AAIvC,UAAM,aAAa,OAAO,UAAU,YAAY;AAChD,SAAK,aAAa;AAElB,SAAK,OAAO,OAAO,gBAAgB,MAAM;AACzC,SAAK,aAAa,OAAO,UAAU,YAAY;AAC/C,SAAK,SAAS,OAAO,QAAQ,QAAQ;AACrC,SAAK,YAAY,OAAO,UAAU,WAAW;AAC7C,SAAK,UAAU,OAAO,UAAU,UAAU;AAC1C,SAAK,MAAM,OAAO,UAAU,KAAK;AACjC,SAAK,eAAe,OAAO,gBAAgB,eAAe;AAC1D,SAAK,UAAU,OAAO,QAAQ,SAAS;AACvC,SAAK,OAAO,OAAO,UAAU,MAAM;AACnC,SAAK,gBAAgB,OAAO,UAAU,gBAAgB;AACtD,SAAK,SAAS,OAAO,UAAU,QAAQ;AACvC,SAAK,cAAc,OAAO,UAAU,cAAc;AAElD,SAAK,cACH,OAAO,UAAU,cAAc,MAAM,KACjC,OAAO,UAAU,YAAY,IAC7B;AACN,SAAK,iBAAiB,OAAO,UAAU,iBAAiB;AACxD,SAAK,kBAAkB,OAAO,QAAQ,mBAAmB;AACzD,SAAK,qBAAqB,OAAO,QAAQ,sBAAsB;AAC/D,SAAK,qBAAqB,OAAO,gBAAgB,sBAAsB;AACvE,SAAK,qBAAqB,OAAO,UAAU,sBAAsB;AACjE,SAAK,0BAA0B,OAAO,gBAAgB,kBAAkB;AACxE,SAAK,uBAAuB,OAAO;AAAA,MACjC;AAAA,IACF;AACA,SAAK,kBAAkB,OAAO,gBAAgB,mBAAmB;AACjE,SAAK,kBAAkB,OAAO,gBAAgB,mBAAmB;AAAA,EACnE;AAAA,EAEQ,QAAQ,UAAkB,MAAsB;AACtD,WAAO,qDAAqD,QAAQ,IAAI,IAAI,IAAI,KAAK,YAAY;AAAA,EACnG;AAAA,EAEA,IAAY,mBAA2B;AACrC,WAAO,4DAA4D,KAAK,YAAY;AAAA,EACtF;AAAA,EAEA,IAAY,gBAAwB;AAClC,QAAI,KAAK,uBAAuB,MAAM;AACpC,aAAO,KAAK;AAAA,IACd,WAAW,KAAK,4BAA4B,MAAM;AAChD,aAAO,KAAK,QAAQ,MAAM,KAAK,uBAAuB;AAAA,IACxD,WAAW,KAAK,oBAAoB,MAAM;AACxC,aAAO,KAAK,QAAQ,OAAO,KAAK,eAAe;AAAA,IACjD,WAAW,KAAK,yBAAyB,MAAM;AAC7C,aAAO,KAAK,QAAQ,OAAO,KAAK,oBAAoB;AAAA,IACtD,WAAW,KAAK,uBAAuB,MAAM;AAC3C,aAAO,KAAK,QAAQ,UAAU,KAAK,kBAAkB;AAAA,IACvD,OAAO;AACL,aAAO,KAAK;AAAA,IACd;AAAA,EACF;AAAA,EAEA,MAAM,OAAsB;AAC1B,UAAM,gBAAgB,KAAK;AAC3B,IAAY,iBAAK,sCAAsC,aAAa,EAAE;AAAA,EACxE;AACF;AAEA,SAAS,OAAa;AACpB,QAAM,eAAe,IAAI,mBAAmB;AAE5C,eAAa,OAAO,OAAO,YAAY;AACrC,UAAM,aAAa,KAAK;AAAA,EAC1B,CAAC;AAED,eAAa,OAAO,QAAQ;AAC9B;AAEA,KAAK;","names":[]}